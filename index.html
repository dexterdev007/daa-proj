<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NP-Completeness Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Source+Code+Pro:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* Define Dark Mode Variables for the visual theme */
        :root {
            --bg-dark: #0a0f1f; /* Deep background color */
            --bg-card: #1e293b; /* Card/Container background */
            --text-main: #E5E7EB; /* Light text */
            --text-secondary: #9CA3AF; /* Gray text */
            --border-color: #374151; /* Border color */
            --primary-blue: #3B82F6; /* Active blue */
            --primary-indigo: #8b5cf6; /* Indigo accent */
            --code-bg: #111827; /* Code block background */
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3f 100%);
            color: var(--text-main);
            transition: background-color 0.3s;
        }
        .font-mono-code {
            font-family: 'Source Code Pro', monospace;
        }

        /* Step Indicator Styling */
        .step-indicator-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            max-width: 400px;
            margin: 0 auto;
        }
        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }
        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            background-color: var(--bg-dark);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            transition: all 0.3s;
        }
        .step-item.active .step-circle {
            background-color: var(--primary-indigo);
            border-color: var(--primary-indigo);
            color: white;
        }
        .step-line {
            position: absolute;
            height: 2px;
            background-color: var(--border-color);
            top: 17px;
            left: 50%;
            right: 50%;
            transform: translateX(-50%);
            transition: all 0.3s;
        }
        .step-line-segment {
            position: absolute;
            height: 2px;
            background-color: var(--primary-indigo);
            transition: background-color 0.3s, width 0.5s ease-out;
            top: 17px;
        }
        
        .code-display {
            background-color: var(--code-bg);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Source Code Pro', monospace;
            overflow-x: auto;
        }

        /* Styling for the graph container */
        #clique-graph-container {
            background-color: #0f172a;
            border: 2px solid var(--primary-indigo);
            touch-action: none;
            display: flex; 
            align-items: center;
            justify-content: center;
            position: relative; 
        }

        /* Global Fade Transition for sections */
        .fade-out {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        .fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Cytoscape.js custom styles */
        .cytoscape-container {
            width: 100%;
            height: 100%;
        }
        
        /* Clause card styling */
        .clause-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }
        
        .clause-number {
            color: var(--primary-indigo);
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        /* Button hover effects */
        .btn-primary {
            background-color: var(--primary-indigo);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.4);
        }
    </style>
</head>
<body class="min-h-screen">
    
    <div class="bg-gradient-to-br from-indigo-600 to-purple-600 py-16 px-4">
        <div class="max-w-6xl mx-auto text-center">
            <header class="flex justify-between items-center mb-10">
                <div class="flex items-center space-x-2 text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.525.434.619.689 1.066-2.572z"></path></svg>
                    <span class="text-lg font-semibold">NP-Completeness Visualizer</span>
                </div>
                <button id="dark-mode-toggle" class="p-2 rounded-full text-white hover:bg-white/20 transition" aria-label="Toggle Dark Mode">
                    <svg id="moon-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </header>

            <h1 class="text-5xl font-extrabold text-white mb-3">NP-Completeness Visualizer</h1>
            <p class="text-xl text-indigo-200 mb-12">
                Explore the fascinating world of computational complexity through interactive visualizations.
            </p>

            <div class="grid md:grid-cols-3 gap-6 text-left">
                <div class="bg-white/10 p-6 rounded-xl border border-white/20 hover:bg-white/20Transition duration-300">
                    <div class="text-4xl text-yellow-300 mb-3">üí°</div>
                    <h3 class="text-xl font-bold text-white mb-2">Learn SAT</h3>
                    <p class="text-indigo-200 text-sm">Understand Boolean satisfiability problems and their significance in computer science.</p>
                </div>
                <div class="bg-white/10 p-6 rounded-xl-border border-white/20 hover:bg-white/20Transition duration-300">
                    <div class="text-4xl text-green-300 mb-3">‚ûó</div>
                    <h3 class="text-xl font-bold text-white mb-2">See 3-CNF</h3>
                    <p class="text-indigo-200 text-sm">Watch formulas transform into 3-conjunctive normal form, the first step of the reduction.</p>
                </div>
                <div class="bg-white/10 p-6 rounded-xl-border border-white/20 hover:bg-white/20Transition duration-500">
                    <div class="text-4xl text-red-300 mb-3">üï∏Ô∏è</div>
                    <h3 class="text-xl font-bold text-white mb-2">Visualize Clique</h3>
                    <p class="text-indigo-200 text-sm">Explore graph representations and the final clique problem reduction steps.</p>
                </div>
            </div>
        </div>
    </div>

    <main class="max-w-4xl mx-auto p-4 md:p-8">

        <div id="input-card" class="bg-gray-800 p-8 rounded-xl shadow-2xl mt-[-50px] Relative z-20Transition duration-500 ease-in-out">
            <h2 class="text-2xl font-bold text-white mb-4">Enter a Boolean Formula</h2>
            <p class="text-md text-gray-400 mb-6">
                Input a SAT formula and watch it transform through 3-CNF to a Clique problem.
            </p>
            
            <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-4 mb-4">
                <input type="text" id="formula-input" class="w-full p-4 font-mono-code text-xl-border border-gray-600 bg-gray-900 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500Transition text-white" 
                    placeholder="e.g., (A OR B OR C) AND (NOT A OR D OR E)" value="(A OR B OR C) AND (NOT A OR D OR E)">
                
                <button id="visualize-btn" class="flex-shrink-0 btn-primary text-white font-bold py-3 px-8 text-lg rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    Visualize ‚Üí
                </button>
            </div>

            <div class="bg-gray-900 p-4 rounded-lg-border border-gray-700 mb-6">
                <p class="text-sm font-semibold text-indigo-400 mb-2">‚ìò Syntax Guide:</p>
                <ul class="text-sm space-y-1 text-gray-300">
                    <li>Use <code class="font-mono-code bg-gray-800 px-2 py-0.5 rounded-md">AND</code> for conjunction between clauses.</li>
                    <li>Use <code class="font-mono-code bg-gray-800 px-2 py-0.5 rounded-md">OR</code> for disjunction within clauses.</li>
                    <li>Use <code class="font-mono-code bg-gray-800 px-2 py-0.5 rounded-md">NOT</code> for negation.</li>
                    <li>Variables are **case-sensitive** (A-Z, X1-Z2, etc.).</li>
                    <li>Example: <code class="font-mono-code bg-gray-800 px-2 py-0.5 rounded-md">(A OR B OR C) AND (NOT A OR D OR E)</code></li>
                </ul>
            </div>
            
            <div class="mt-6">
                <p class="text-sm font-semibold text-gray-300 mb-2">Try these examples:</p>
                <div id="example-buttons" class="flex flex-wrap gap-3">
                    <button data-formula="(A OR B OR C) AND (NOT A OR D OR E) AND (B OR NOT D OR F)" class="example-btn font-mono-code text-xs bg-indigo-900/50 text-indigo-300 px-3 py-1 rounded-full hover:bg-indigo-800/50Transition">
                        (A OR B OR C) AND (NOT A OR D OR E) AND (B OR NOT D OR F)
                    </button>
                    
                    <button data-formula="(X OR Y OR Z) AND (NOT X OR NOT Y OR W) AND (Z OR W OR V)" class="example-btn font-mono-code text-xs bg-indigo-900/50 text-indigo-300 px-3 py-1 rounded-full hover:bg-indigo-800/50Transition">
                        (X OR Y OR Z) AND (NOT X OR NOT Y OR W) AND (Z OR W OR V)
                    </button>
                    
                    <button data-formula="(P OR Q OR R) AND (NOT P OR S OR T) AND (NOT Q OR NOT S OR U)" class="example-btn font-mono-code text-xs bg-indigo-900/50 text-indigo-300 px-3 py-1 rounded-full hover:bg-indigo-800/50Transition">
                        (P OR Q OR R) AND (NOT P OR S OR T) AND (NOT Q OR NOT S OR U)
                    </button>
                </div>
            </div>
        </div>

        <section id="reduction-steps-container" class="mt-12 hidden fade-out">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-extrabold text-white">Reduction Steps</h2>
                <div class="flex space-x-2">
                    <button id="back-step-btn" class="flex items-center btn-primary text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-700Transition">
                        <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg>
                        Back
                    </button>
                    <button id="next-step-btn" class="flex items-center bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-600Transition">
                        Next Step
                        <svg class="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>

            <div class="step-indicator-container mb-8">
                <div id="step-line-fill" class="step-line-segment" style="width: 0%;"></div>
                <div class="step-item active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="mt-2 text-sm">SAT</div>
                </div>
                <div class="step-line" style="width: 50%;"></div>
                <div class="step-item" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="mt-2 text-sm">3-CNF</div>
                </div>
                <div class="step-line" style="width: 50%;"></div>
                <div class="step-item" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="mt-2 text-sm">Clique</div>
                </div>
            </div>

            <div id="step-panels-container" class="space-y-8">
                
                <div id="panel-1" class="bg-gray-800 p-8 rounded-xl fade-in transition duration-500">
                    <h3 class="text-xl font-bold text-indigo-400 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.24a2 2 0 010 2.828l-8 8a2 2 0 01-2.828 0l-4-4a2 2 0 010-2.828l4-4a2 2 0 012.828 0l4 4a2 2 0 002.828 0l4-4a2 2 0 012.828 0z"></path></svg>
                        SAT Formula
                    </h3>
                    <p class="text-md text-gray-400 mb-4">Original SAT formula in Boolean form:</p>

                    <div class="code-display text-2xl font-mono-code text-white mb-6 p-6 text-center">
                        <span id="sat-output"></span>
                    </div>
                    
                    <div class="p-4 bg-gray-900-border border-gray-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-2">What is SAT?</h4>
                        <p class="text-sm text-gray-400">
                            The Boolean Satisfiability Problem (SAT) asks whether there exists an assignment of truth values to variables that makes the entire formula true. SAT was the first problem proven to be NP-complete, making it a cornerstone of computational complexity theory.
                        </p>
                    </div>
                </div>

                <div id="panel-2" class="bg-gray-800 p-8 rounded-xl fade-out hiddenTransition duration-500">
                    <h3 class="text-xl font-bold text-indigo-400 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        3-CNF Conversion
                    </h3>
                    <p id="3cnf-stats" class="text-md text-gray-400 mb-4">Converted to 3-CNF with exactly 3 literals per clause. Each clause is a disjunction (OR) of three literals.</p>

                    <div id="3cnf-output" class="code-display text-lg font-mono-code text-white mb-6 p-6 space-y-3">
                    </div>
                    
                    <div class="p-4 bg-gray-900-border border-gray-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-2">What is 3-CNF?</h4>
                        <p class="text-sm text-gray-400">
                            3-Conjunctive Normal Form (3-CNF) is a standardized format where a formula is expressed as a conjunction (AND) of clauses, where each clause is a disjunction (OR) of **exactly three literals**. Any SAT formula can be converted to 3-CNF in polynomial time, proving 3-SAT is NP-complete.
                        </p>
                    </div>
                </div>

                <div id="panel-3" class="bg-gray-800 p-8 rounded-xl fade-out hiddenTransition duration-500">
                    <h3 class="text-xl font-bold text-indigo-400 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        CLIQUE Graph
                    </h3>
                    <p id="clique-stats" class="text-md text-gray-400 mb-4">Graph where nodes represent literals and edges connect compatible literals from different clauses. A clique of size k (number of clauses) indicates a satisfying assignment exists.</p>

                    <div id="clique-graph-container" class="relative w-full h-[550px] rounded-xl overflow-hidden shadow-inner border-2 border-gray-700 mb-4">
                    </div>
                    
                    <div class="flex flex-col md:flex-row justify-between items-center bg-gray-900 p-4 rounded-lg-border border-gray-700 mb-6">
                        <p class="text-white font-semibold mb-2 md:mb-0">Find a Clique of size <span id="k-value" class="text-yellow-400 text-lg">k</span>:</p>
                        <button id="find-clique-btn" class="flex items-center btn-success text-white font-bold py-2 px-6 rounded-lg shadow-md disabled:bg-gray-600">
                            Highlight Satisfying Clique
                        </button>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-gray-900-border border-gray-700 rounded-lg">
                            <h4 class="text-lg font-semibold text-white mb-2">Nodes</h4>
                            <p class="text-sm text-gray-400">Each node represents a **literal** (e.g., A or ¬¨B) from a specific 3-CNF clause. Nodes are colored by their source clause.</p>
                        </div>
                        <div class="p-4 bg-gray-900-border border-gray-700 rounded-lg">
                            <h4 class="text-lg font-semibold text-white mb-2">Edges</h4>
                            <p class="text-sm text-gray-400">An edge exists if two literals belong to **different clauses** AND are **not contradictory** (e.g., X and ¬¨X).</p>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900-border border-gray-700 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-2">What is the Clique Problem?</h4>
                        <p class="text-sm text-gray-400">
                            The existence of a **Clique** (a complete subgraph) of size k (the number of 3-CNF clauses) proves the original SAT formula is satisfiable. This reduction shows that 3-SAT is polynomially reducible to CLIQUE, proving CLIQUE is also NP-complete.
                        </p>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <footer class="text-center py-6 text-gray-500 text-sm border-t border-gray-700 mt-12">
        Built for NP-Completeness visualization practice.
    </footer>

    <script>
        // =================================================================
        // CLIQUE GRAPH RENDERING USING CYTOSCAPE.JS
        // =================================================================

        let cy = null; // Cytoscape instance

        function createCliqueGraph(clauses) {
            const graphData = buildCliqueGraph(clauses);
            
            if (cy) {
                cy.destroy();
            }
            
            cy = cytoscape({
                container: document.getElementById('clique-graph-container'),
                elements: [
                    ...graphData.nodes.map(node => ({ 
                        data: { 
                            id: node.id, 
                            label: node.label, 
                            clause: node.clause 
                        } 
                    })),
                    ...graphData.edges.map(edge => ({ 
                        data: { 
                            source: edge.source, 
                            target: edge.target 
                        } 
                    }))
                ],
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': function(ele) {
                                const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];
                                return colors[(ele.data('clause') - 1) % colors.length];
                            },
                            'label': 'data(label)',
                            'color': '#fff',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'font-weight': 'bold',
                            'font-size': '14px',
                            'width': 50,
                            'height': 50,
                            'border-width': 2,
                            'border-color': '#fff',
                            'overlay-opacity': 0,
                            'transition-property': 'background-color, border-width, width, height',
                            'transition-duration': '0.3s'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#4b5563',
                            'opacity': 0.6,
                            'transition-property': 'line-color, width, opacity',
                            'transition-duration': '0.3s'
                        }
                    },
                    {
                        selector: '.highlighted',
                        style: {
                            'background-color': '#22c55e',
                            'border-width': 4,
                            'width': 60,
                            'height': 60,
                            'z-index': 999
                        }
                    },
                    {
                        selector: '.highlighted-edge',
                        style: {
                            'line-color': '#22c55e',
                            'width': 4,
                            'opacity': 1
                        }
                    },
                    {
                        selector: '.selected',
                        style: {
                            'background-color': '#22c55e',
                            'border-width': 4,
                            'border-color': '#16a34a',
                            'width': 60,
                            'height': 60,
                            'z-index': 998
                        }
                    },
                    {
                        selector: '.selected-edge',
                        style: {
                            'line-color': '#22c55e',
                            'width': 3,
                            'opacity': 0.8
                        }
                    }
                ],
                layout: { 
                    name: 'cose', 
                    padding: 50,
                    randomize: true,
                    animate: true,
                    animationDuration: 1000,
                    idealEdgeLength: 100,
                    nodeOverlap: 20,
                    refresh: 20,
                    fit: true
                }
            });

            // Node click interaction with toggle
            cy.on('tap', 'node', function(evt) {
                const node = evt.target;
                
                // Check if node is already selected
                if (node.hasClass('selected')) {
                    // Remove selection
                    node.removeClass('selected');
                    node.connectedEdges().removeClass('selected-edge');
                    node.connectedEdges().connectedNodes().removeClass('selected');
                } else {
                    // Add selection
                    node.addClass('selected');
                    node.connectedEdges().addClass('selected-edge');
                    node.connectedEdges().connectedNodes().addClass('selected');
                }
            });

            return cy;
        }

        function highlightClique() {
            if (!cy) return;
            
            // Clear both clique highlights and individual selections
            cy.elements().removeClass('highlighted highlighted-edge selected selected-edge');
            
            // Select one node from each clause
            const clique = [];
            const numClauses = Math.max(...cy.nodes().map(n => n.data('clause')));
            
            for (let clause = 1; clause <= numClauses; clause++) {
                const nodesInClause = cy.nodes().filter(node => node.data('clause') === clause);
                if (nodesInClause.length > 0) {
                    clique.push(nodesInClause[0]);
                }
            }
            
            // Highlight clique nodes
            clique.forEach(node => node.addClass('highlighted'));
            
            // Highlight edges between clique nodes
            for (let i = 0; i < clique.length; i++) {
                for (let j = i + 1; j < clique.length; j++) {
                    const edge = cy.edges(`[source = "${clique[i].id()}"][target = "${clique[j].id()}"], [source = "${clique[j].id()}"][target = "${clique[i].id()}"]`);
                    edge.addClass('highlighted-edge');
                }
            }
            
            return clique;
        }

        // =================================================================
        // MAIN APPLICATION LOGIC
        // =================================================================

        // --- UI Elements ---
        const formulaInput = document.getElementById('formula-input');
        const visualizeBtn = document.getElementById('visualize-btn');
        const nextStepBtn = document.getElementById('next-step-btn');
        const backStepBtn = document.getElementById('back-step-btn');
        const findCliqueBtn = document.getElementById('find-clique-btn');
        const exampleButtons = document.querySelectorAll('.example-btn');
        
        const reductionContainer = document.getElementById('reduction-steps-container');
        const stepItems = document.querySelectorAll('.step-item');
        const stepLineFill = document.getElementById('step-line-fill');
        const stepPanels = [
            document.getElementById('panel-1'),
            document.getElementById('panel-2'),
            document.getElementById('panel-3')
        ];

        // --- Data & State ---
        let currentStep = 0; // 0: Input, 1: SAT, 2: 3-CNF, 3: CLIQUE
        let isCliqueHighlighted = false; // Track highlight state
        let transformationData = {
            originalFormula: '',
            clauses: [],
            k: 0
        };

        // --- UTILITY FUNCTIONS (Parsing & Reduction) ---
        
        function cleanFormula(input) {
            let cleaned = input.toUpperCase();
            cleaned = cleaned.replace(/\s+/g, '').trim();
            return cleaned;
        }

        function parseFormula(input) {
            try {
                const cleanedInput = cleanFormula(input);
                if (!cleanedInput) return [];
                
                const clauses = cleanedInput.split('AND')
                    .map(c => c.replace(/[()]/g, '')) 
                    .filter(c => c.length > 0)
                    .map(c => c.split('OR').map(l => l.trim()).filter(l => l.length > 0)); 
                
                return clauses;
            } catch (e) { return null; }
        }
        
        function areContradictory(literal1, literal2) {
            const l1 = literal1.replace('NOT', '');
            const l2 = literal2.replace('NOT', '');
            const neg1 = literal1.startsWith('NOT');
            const neg2 = literal2.startsWith('NOT');
            return l1 === l2 && neg1 !== neg2;
        }

        function convertTo3CNF(formula) {
            const clauses = parseFormula(formula);
            if (!clauses) return [];
            
            const result = [];
            
            clauses.forEach(clause => {
                let processedClause = clause;
                
                // If fewer than 3 literals, duplicate the last literal
                while (processedClause.length < 3) {
                    processedClause.push(processedClause[processedClause.length - 1]);
                }
                
                // Take first 3 literals
                result.push(processedClause.slice(0, 3));
            });
            
            return result;
        }

        function buildCliqueGraph(clauses) {
            let nodes = [];
            let edges = [];

            clauses.forEach((clause, i) => {
                clause.forEach(lit => {
                    // Node ID: ${literal}_${clauseIndex+1}
                    const nodeId = `${lit}_${i + 1}`;
                    const label = lit.replace('NOT', '¬¨');
                    const node = { id: nodeId, label: label, clause: i + 1 };
                    nodes.push(node);
                });
            });

            // Build Edges based on the CLIQUE rule
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const n1 = nodes[i];
                    const n2 = nodes[j];
                    
                    // Rule 1: Different clauses
                    const isDifferentClause = n1.clause !== n2.clause;
                    
                    // Rule 2: Not contradictory
                    const isCompatible = !areContradictory(n1.label.replace('¬¨', 'NOT'), n2.label.replace('¬¨', 'NOT'));
                    
                    if (isDifferentClause && isCompatible) {
                        edges.push({ source: n1.id, target: n2.id });
                    }
                }
            }
            return { nodes, edges, k: clauses.length };
        }

        function processFormula(formula) {
            const clauses = convertTo3CNF(formula);
            const graphData = buildCliqueGraph(clauses);
            
            return {
                sat: { formula, explanation: "Original SAT formula in Boolean form" },
                cnf: { clauses, explanation: "Converted to 3-CNF with exactly 3 literals per clause" },
                clique: { nodes: graphData.nodes, edges: graphData.edges, k: graphData.k, explanation: "Graph representation for CLIQUE problem" }
            };
        }

        // --- UI Control Functions ---
        
        function updateButtonState(step) {
            nextStepBtn.disabled = step >= 3;
            backStepBtn.disabled = step <= 1;
            findCliqueBtn.disabled = step < 3;
        }

        function updateStepUI(step) {
            // Update Step Indicators
            stepItems.forEach(item => {
                const itemStep = parseInt(item.getAttribute('data-step'));
                item.classList.toggle('active', itemStep <= step);
            });

            if (step === 1) stepLineFill.style.width = '0%';
            else if (step === 2) stepLineFill.style.width = '50%';
            else if (step === 3) stepLineFill.style.width = '100%';

            // Update Panels Visibility
            stepPanels.forEach((panel, index) => {
                const panelStep = index + 1;
                const isCurrent = panelStep === step;

                if (isCurrent) {
                    panel.classList.remove('hidden', 'fade-out');
                    panel.classList.add('fade-in');
                } else {
                    panel.classList.remove('fade-in');
                    panel.classList.add('fade-out');
                    setTimeout(() => {
                        if (!panel.classList.contains('fade-in')) {
                            panel.classList.add('hidden');
                        }
                    }, 400); 
                }
            });
            
            updateButtonState(step);
        }

        // --- Data Rendering ---

        function renderSAT(formula) {
            document.getElementById('sat-output').textContent = formula;
        }

        function render3CNF(clauses, originalCount) {
            document.getElementById('3cnf-stats').innerHTML = `The original formula resulted in **${clauses.length}** 3-CNF clauses, each containing exactly 3 literals.`;
            
            const outputEl = document.getElementById('3cnf-output');
            outputEl.innerHTML = clauses.map((clause, index) => `
                <div class="clause-card">
                    <span class="clause-number">C${index + 1}:</span>
                    <span>[${clause.map(l => l.replace('NOT', '¬¨')).join(', ')}]</span>
                </div>
            `).join('<span class="text-indigo-400 font-bold mx-2">‚àß</span>');
        }

        function renderClique(data) {
            document.getElementById('k-value').textContent = data.k;
            document.getElementById('clique-stats').innerHTML = `Graph where nodes represent literals and edges connect compatible literals from different clauses. A clique of size **k** (${data.k}) indicates a satisfying assignment exists.`;
            
            // Create the graph using Cytoscape.js
            createCliqueGraph(data.clauses);
        }

        // --- Main Flow Control ---

        function initFlow() {
            currentStep = 0;
            isCliqueHighlighted = false; // Reset highlight state
            
            const inputFormula = formulaInput.value;
            if (!inputFormula) return;

            const originalClauses = parseFormula(inputFormula);
            if (!originalClauses || originalClauses.some(c => c.length === 0)) {
                console.error("Invalid formula format. Please check your input and operators.");
                return;
            }

            reductionContainer.classList.remove('hidden', 'fade-out');
            reductionContainer.classList.add('fade-in');

            const processedData = processFormula(inputFormula);
            
            transformationData = {
                originalFormula: inputFormula,
                clauses: processedData.cnf.clauses,
                k: processedData.clique.k
            };
            
            // Render all content (Step 1, 2, and initial Step 3 setup)
            renderSAT(processedData.sat.formula);
            render3CNF(processedData.cnf.clauses, originalClauses.length);
            renderClique(transformationData); 

            currentStep = 1;
            updateStepUI(currentStep);
        }

        function advanceStep() {
            if (currentStep < 3) {
                currentStep++;
                updateStepUI(currentStep);
                
                // Reset highlight when entering step 3
                if (currentStep === 3) {
                    isCliqueHighlighted = false;
                    const btn = document.getElementById('find-clique-btn');
                    if (btn) btn.textContent = 'Highlight Satisfying Clique';
                    
                    if (cy) {
                        // Animate graph layout
                        cy.layout({
                            name: 'cose',
                            animate: true,
                            animationDuration: 1000,
                            fit: true
                        }).run();
                    }
                }
            }
        }

        function goBackStep() {
            if (currentStep > 1) {
                // Reset highlight when leaving step 3
                if (currentStep === 3) {
                    if (isCliqueHighlighted) {
                        isCliqueHighlighted = false;
                    }
                    if (cy) {
                        cy.elements().removeClass('highlighted highlighted-edge selected selected-edge');
                    }
                }
                
                currentStep--;
                updateStepUI(currentStep);
            }
        }

        function handleCliqueFind() {
            const btn = document.getElementById('find-clique-btn');
            
            if (isCliqueHighlighted) {
                // Remove highlighting
                if (cy) {
                    cy.elements().removeClass('highlighted highlighted-edge');
                }
                isCliqueHighlighted = false;
                btn.textContent = 'Highlight Satisfying Clique';
                
                // Reset stats text
                document.getElementById('clique-stats').innerHTML = `Graph where nodes represent literals and edges connect compatible literals from different clauses. A clique of size <strong>k</strong> (${transformationData.k}) indicates a satisfying assignment exists.`;
            } else {
                // Clear any individual node selections before highlighting clique
                if (cy) {
                    cy.elements().removeClass('selected selected-edge');
                }
                
                // Add highlighting
                const clique = highlightClique();
                if (clique && clique.length > 0) {
                    isCliqueHighlighted = true;
                    btn.textContent = 'Clear Highlight';
                    
                    // Extract assignment from clique
                    const assignment = {};
                    clique.forEach(node => {
                        const label = node.data('label');
                        const variable = label.replace('¬¨', '');
                        const isNegated = label.startsWith('¬¨');
                        assignment[variable] = !isNegated;
                    });
                    
                    let assignmentText = Object.entries(assignment)
                        .map(([v, t]) => `${v}=${t ? 'T' : 'F'}`).join(', ');
                        
                    document.getElementById('clique-stats').innerHTML = `
                        <span class="text-cyan-400 font-bold">A satisfying clique of size ${clique.length} was found!</span> 
                        This corresponds to the assignment: <code class="font-mono-code bg-gray-700 px-2 py-1 rounded-md text-white">${assignmentText}</code>.
                    `;
                } else {
                     document.getElementById('clique-stats').innerHTML = `
                        <span class="text-red-400 font-bold">Could not find a simple satisfying clique.</span> The formula is likely unsatisfiable or requires a more complex search.
                    `;
                }
            }
        }

        // --- Initialization and Event Bindings ---

        visualizeBtn.addEventListener('click', initFlow);
        nextStepBtn.addEventListener('click', advanceStep);
        backStepBtn.addEventListener('click', goBackStep);
        findCliqueBtn.addEventListener('click', handleCliqueFind);
        
        exampleButtons.forEach(button => {
            button.addEventListener('click', () => {
                formulaInput.value = button.getAttribute('data-formula');
                initFlow();
            });
        });

        document.getElementById('dark-mode-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });
    </script>
</body>
</html>
